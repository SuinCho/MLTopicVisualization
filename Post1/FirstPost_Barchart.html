<!DOCTYPE html>
<html lang="en">
<head>
    <head>
        <script src="https://d3js.org/d3.v4.min.js"></script>
    </head>
</head>

<body>
<!-- Code here -->
<div id = "barchartviz">
<h1>1. Bar Chart</h1>
<svg id = "svg1" width = "10000" height = "500"></svg></div>

<div id = "scatterplotviz">
<h1>2. Scatter Plot</h1>
<svg id = "svg2" width = "10000" height = "500"></svg></div>
</div>
<div id = "practice"></div>
<script>

    // Bar chart 
    var svg = d3.select("#svg1"), margin = 200, width = svg.attr("width") - margin, height = svg.attr("height") - margin
    var XScale = d3.scaleBand().range([0, width]).padding(0.5),
        YScale = d3.scaleLinear().range([height, 0]);
        var g = svg.append("g")
               .attr("transform", "translate(" + 100 + "," + 100 + ")");
    svg.append("text")
        .attr("transform", "translate(100,0)")
        .attr("x", 50)
        .attr("y", 50)
        .attr("font-size", "24px")
        .text("Happiness rate of each country")

    // Retrieve the csv data of 2016 
    d3.csv("./archive/2016.csv", function(data) {
        XScale.domain(data.map(function(d) { return d.Country; }));
        YScale.domain([0, d3.max(data, function(d) { return d.Freedom; })]);

        g.append("g")
         .attr("transform", "translate(0," + height + ")")
         .call(d3.axisBottom(XScale))
         .append("text")
         .attr("y", height - 250)
         .attr("x", width - 100)
         .attr("text-anchor", "end")
         .attr("stroke", "black")
         .text("Country");

        g.append("g")
         .call(d3.axisLeft(YScale).tickFormat(function(d){
             return d;
         })
         .ticks(10))
         .append("text")
         .attr("transform", "rotate(-90)")
         .attr("y", 6)
         .attr("dy", "-5.1em")
         .attr("text-anchor", "end")
         .attr("stroke", "black")
         .text("Happiness Rate");

        g.selectAll(".bar")
         .data(data)
         .enter().append("rect")
         .attr("class", "bar")
         .attr("x", function(d) { return XScale(d.Country); })
         .attr("y", function(d) { return YScale(d.Freedom); })
         .attr("width", XScale.bandwidth())
         .attr("height", function(d) { return height - YScale(d.Freedom); });
        for (var i = 0; i < data.length; i++) {
            //console.log(data[i]);
            var data2 = data[i];
            console.log(data2);
        }
    });

// Scatter Plot
var svg2 = d3.select("#svg2"), margin = 200, width = svg2.attr("width") - margin, height = svg2.attr("height") - margin;
    // Setup X
    var XVal = function(d) {return d.GDP;}, 
        XScale2 = d3.scaleLinear().range([0, width]),
        XMap = function(d) {return XScale2(XVal(d));}, //
        xAxis = d3.svg.axis().scale(XScale2);
    // Setup Y
    var YVal = function(d) {return d.Ladderscore;},   
        YScale2 = d3.scaleLinear().range([height, 0]),
        YMap = function(d) {return YScale2(YVal(d));};
        yAxis = d3.svg.axis().scale(YScale2);
    var g2 = svg2.append("g")
        .attr("transform", "translate(" + 100 + "," + 100 + ")");
    svg2.append("text")
        .attr("transform", "translate(100,0)")
        .attr("x", 50)
        .attr("y", 50)
        .attr("font-size", "24px")
        .text("Happiness rate Linear regression")

    // Draw the regression line 
    var newline = d3.line()
        .x(function(d) {
            return xScale(d.GDP);
        })
    .y(function(d) {
            return yScale(d.Ladderscore);
        });

    // Retrieve the csv data 
    d3.csv("./archive/2020_revised.csv", function(data) {
        XScale2.domain(data.map(function(d) { return d.GDP; }));
        //XScale2.domain(d3.extent(data, function(d) { return d.GDP; }));
        YScale2.domain([0, d3.max(data, function(d) { return d.Ladderscore; })]);

        g2.append("g")
         .attr("transform", "translate(0," + height + ")")
         .call(xScale2)
         .append("text")
         .attr("y", height - 250)
         .attr("x", width - 100)
         .attr("text-anchor", "end")
         .attr("stroke", "black")
         .text("GDP");

        g2.append("g")
         .call(d3.axisLeft(YScale2).tickFormat(function(d){
             return d;
         })
         .ticks(10))
         .append("text")
         .attr("transform", "rotate(-90)")
         .attr("y", 6)
         .attr("dy", "-5.1em")
         .attr("text-anchor", "end")
         .attr("stroke", "black")
         .text("Happiness Rate")
        console.log(XScale2(data.GDP));
        console.log(YScale2(data.Ladderscore));
        
        // Add dots 
        svg2.selectAll("circle").data(data).enter().append("circle")
        .attr("r", 3.5)
        .attr("cx", function(data) { return XScale2(d.GDP);})
        .attr("cy", function(data) { return YScale2(d.Ladderscore);})
        .attr("fill", "pink")
        // Add mouseover interaction 
        .on("mouseover", function(d) {
            tooltip.transition().duration(200).style("opacity", .9);
        })
        .on("mouseout", function(d) {
            tooltip.transition().duration(500).style("opacity", .0);
        })
    });


</script>
</body>
<style>
    body {
        font: 11px sans-serif;
        }
    #container {
        height: 100px;
        width: 100px;
        background-color: black;
    }
    .error {
        color: red
    }
    .bar {
            fill: steelblue;
        }

    .highlight {
            fill: pink;
        }
    .dot {
        stroke: #000;
        }

    .tooltip {
        position: absolute;
        width: 200px;
        height: 28px;
        pointer-events: none;
        }
    .chart .xAxis path,line {
        stroke: #dddddd;
    }

    .chart .yAxis path,line {
        stroke: #dddddd;
    }

    .chart circle {
        fill: #aaaaaa;
    }

    .chart path.regressionLine {
        stroke: #43A047;
        fill: none;
        stroke-width: 1.2;
        stroke-dasharray: 3,5;
    }
</style>

</html>